diff a/vtest/vtest_server.c b/vtest/vtest_server.c	(rejected hunks)
@@ -126,7 +126,12 @@ static void vtest_server_close_socket(void);
 static int vtest_client_dispatch_commands(struct vtest_client *client);
 
 
+#if _EXPORT_MAIN == 1
 int main(int argc, char **argv)
+#else
+VIRGL_EXPORT int vtest_main(int argc, char **argv);
+int vtest_main(int argc, char **argv)
+#endif
 {
 #ifdef __AFL_LOOP
 while (__AFL_LOOP(1000)) {
@@ -263,6 +270,10 @@ static void vtest_server_getenv(void)
    server.use_egl_surfaceless = getenv("VTEST_USE_EGL_SURFACELESS") != NULL;
    server.use_gles = getenv("VTEST_USE_GLES") != NULL;
    server.render_device = getenv("VTEST_RENDERNODE");
+   const char *socket_name = getenv("VTEST_SOCKET_NAME");
+   if (socket_name) {
+       server.socket_name = socket_name;
+   }
 }
 
 static void handler(int sig, siginfo_t *si, void *unused)
